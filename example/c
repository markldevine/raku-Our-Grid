#!/usr/bin/env raku

enum Color is export (
    black   => 0, light-black   => 60,
    red     => 1, light-red     => 61,
    green   => 2, light-green   => 62,
    yellow  => 3, light-yellow  => 63,
    blue    => 4, light-blue    => 64,
    magenta => 5, light-magenta => 65,
    cyan    => 6, light-cyan    => 66,
    white   => 7, light-white   => 67,
    default-color => 9,
);

enum Effects is export (
    default-mode => 0, # Turn off all attributes
    bold         => 1, # Set bold mode
    italic       => 3, # Set italic mode
    underline    => 4, # Set underline mode
    blink        => 5, # Set blink mode
    swap         => 7, # Exchange foreground and background colors
    hide         => 8  # Hide text (foreground color would be the same as background)
);

sub color (Str:D :$text, :$fg, :$bg, :$ef) {
    my $foreground = $fg;
    my $background = $bg;
    my @e;
    given $ef {
        when Positional { @e = $_;      put 'Positional'; }
        when Str        { @e = ($_);    put 'Str'; }
        when Int        { @e = ($_);    put 'Int'; }
        default         { die;              }
    }
    my @effects;
    for @e -> $e {
        @effects.push: $e if 1 <= $e < 60;
    }
    printf("%s%s%s%s\o33[0m\n",
        $foreground     ?? "\o33[38;5;" ~ $foreground   ~ 'm'   !! '',
        $background     ?? "\o33[48;5;" ~ $background   ~ 'm'   !! '',
        @effects.elems  ?? "\o33[" ~ @effects.join(';') ~ 'm'   !! '',
        $text);
}

color(:text("test message"), :fg(7), :bg(88), :ef(2));
